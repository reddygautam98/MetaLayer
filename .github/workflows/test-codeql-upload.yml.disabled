name: ðŸ§ª Test CodeQL SARIF Upload

on:
  workflow_dispatch:
  push:
    paths:
      - '.github/workflows/test-codeql-upload.yml'

permissions:
  actions: read
  contents: read
  security-events: write
  id-token: write

jobs:
  test-codeql-upload:
    name: ðŸ” Test CodeQL SARIF Upload
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Create test SARIF file
        run: |
          echo "ðŸ“„ Creating test SARIF file..."
          cat > test-results.sarif << 'EOF'
          {
            "version": "2.1.0",
            "$schema": "https://raw.githubusercontent.com/oasis-tcs/sarif-spec/master/Schemata/sarif-schema-2.1.0.json",
            "runs": [
              {
                "tool": {
                  "driver": {
                    "name": "Test Tool",
                    "version": "1.0.0"
                  }
                },
                "results": [
                  {
                    "ruleId": "test-rule",
                    "level": "warning",
                    "message": {
                      "text": "This is a test security finding"
                    },
                    "locations": [
                      {
                        "physicalLocation": {
                          "artifactLocation": {
                            "uri": "test-file.txt"
                          },
                          "region": {
                            "startLine": 1,
                            "startColumn": 1
                          }
                        }
                      }
                    ]
                  }
                ]
              }
            ]
          }
          EOF
          
          echo "âœ… SARIF file created"
          ls -la test-results.sarif
          echo "ðŸ“Š File contents:"
          cat test-results.sarif

      - name: Upload test SARIF to CodeQL
        uses: github/codeql-action/upload-sarif@v3
        with:
          sarif_file: 'test-results.sarif'
          category: 'test-upload'

      - name: Test complete
        run: |
          echo "ðŸŽ‰ Test completed successfully!"
          echo "Check the Security tab -> Code scanning for uploaded results"